define(function (require, exports, module) {
    "use strict";

    var Core = app.getModule("core/Core");
    var UML               = app.getModule("uml/UML");
    var Graphics          = require("Graphics");

    function UMLExceptionFlow() {
        type.UMLControlFlow.apply(this, arguments);
    }

    UMLExceptionFlow.prototype = Object.create(type.UMLControlFlow.prototype);
    UMLExceptionFlow.prototype.constructor = UMLExceptionFlow;

    function UMLExceptionFlowView() {
        type.UMLControlFlowView.apply(this, arguments);
        this.lineColor = '#ff0000';
        this.fontColor = '#ff0000';
        //this.tailEndStyle= 11;
        this.base64Image = 'data:image/png;base64,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';
    }

    UMLExceptionFlowView.prototype = Object.create(type.UMLControlFlowView.prototype);
    UMLExceptionFlowView.prototype.constructor = UMLExceptionFlowView;
    UMLExceptionFlowView.prototype.getStereotypeLabelText = function () {
        return "«Exception»";
    };

    UMLExceptionFlowView.prototype.drawObject = function (canvas) {
        type.UMLControlFlowView.prototype.drawObject.call(this, canvas);
        if(this.base64Image != null) {
            this.errorIconLeft = this.points.getPoint(0).x;
            this.errorIconTop = this.points.getPoint(0).y;
            Graphics.drawErrorIcon.call(this, this.iconName, canvas, this.base64Image);
        }
        this.drawIcon(canvas, this.rect);
    };

    UMLExceptionFlowView.prototype.drawIcon = function (canvas, rect) {
        if(this.base64Image != null) {
            Graphics.drawImage.call(this, this.iconName, canvas, this.base64Image);
        }
    };

    //# Backbone
    type.UMLExceptionFlow     = UMLExceptionFlow;
    type.UMLExceptionFlowView = UMLExceptionFlowView;
});